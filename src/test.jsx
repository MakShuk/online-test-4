import React, { useState } from "react";
import Question from "./components/Question";
import Results from "./components/Results";

// Константы
const INITIAL_ANSWERS = new Array(8).fill([]);  // 8 вопросов в тесте


// Константы
const INITIAL_TEST = {
  "testName": "Коммуникация на работе",
  "description": "Тест о коммуникации с коллегами, сотрудниками, руководителями и клиентами",
  "modules": [
    {
      "name": "Коммуникация на работе",
      "questions": [
        {
          "id": 1,
          "text": "Как мотивировать коллегу-производителя? Выберите одно из утверждений",
          "options": [
            "Сформулируйте конкретную задачу и изложите смысл. И что нужно получить в результате: «Нужно срочно решить проблему, чтобы быстро получить результат!»",
            "Сначала обрисуйте общую картину проблемы/задачи, никогда не начинайте с деталей. И обязательно поинтересуйтесь мнением коллеги: «У нас проблема! Какие у вас есть идеи для ее решения?»",
            "Задача, которая принесет людям пользу, помощь. Помогите коллеге детально и конкретно прописать шаги, так как ему сложно сделать это самостоятельно: «Нужна ваша помощь!»"
          ],
          "correctAnswer": 0,
          "type": "singleChoice"
        },
        {
          "id": 2,
          "text": "Как мотивировать коллегу-администратора? Выберите одно из утверждений",
          "options": [
            "Сформулируйте конкретную задачу и изложите смысл. И что нужно получить в результате: «Нужно срочно решить проблему, чтобы быстро получить результат!»",
            "Сначала пришлите коллеге свое предложение в письменном виде для изучения, затем уже приступите к разговору: «Я предлагаю алгоритм решения нашей задачи, который позволит избежать все риски»",
            "Сначала обрисуйте общую картину проблемы/задачи, никогда не начинайте с деталей. И обязательно поинтересуйтесь мнением коллеги: «У нас проблема! Какие у вас есть идеи для ее решения?»"
          ],
          "correctAnswer": 1,
          "type": "singleChoice"
        },
        {
          "id": 3,
          "text": "Как мотивировать коллегу-предпринимателя? Выберите одно из утверждений",
          "options": [
            "Сформулируйте конкретную задачу и изложите смысл. И что нужно получить в результате: «Нужно срочно решить проблему, чтобы быстро получить результат!»",
            "Сначала пришлите коллеге свое предложение в письменном виде для изучения, затем уже приступите к разговору: «Я предлагаю алгоритм решения нашей задачи, который позволит избежать все риски»",
            "Сначала обрисуйте общую картину проблемы/задачи, никогда не начинайте с деталей. И обязательно поинтересуйтесь мнением коллеги: «У нас проблема! Какие у вас есть идеи для ее решения?»"
          ],
          "correctAnswer": 2,
          "type": "singleChoice"
        },
        {
          "id": 4,
          "text": "Как мотивировать коллегу-интегратора? Выберите одно из утверждений",
          "options": [
            "Сформулируйте конкретную задачу и изложите смысл. И что нужно получить в результате: «Нужно срочно решить проблему, чтобы быстро получить результат!»",
            "Сначала пришлите коллеге свое предложение в письменном виде для изучения, затем уже приступите к разговору: «Я предлагаю алгоритм решения нашей задачи, который позволит избежать все риски»",
            "Задача, которая принесет людям пользу, помощь. Помогите коллеге детально и конкретно прописать шаги, так как ему сложно сделать это самостоятельно: «Нужна ваша помощь!»"
          ],
          "correctAnswer": 2,
          "type": "singleChoice"
        },
        {
          "id": 5,
          "text": "Как попросить руководителя-производителя? Выберите одно из утверждений",
          "options": [
            "Сформулируйте свое предложение как возможность для развития и спросите совета, мнения руководителя по поводу вашей идеи",
            "Сначала всегда представьте предложение в письменном виде, оформите предложение с четкими инструкциями, графиками, выводами, схемами",
            "Сформулируйте как можно конкретнее, что вы хотите. Объясните смысл (для чего это вам нужно)",
            "Прежде чем представить план на рассмотрение руководителю, заручитесь поддержкой других членов команды, на которых, по его мнению, держится власть"
          ],
          "correctAnswer": 2,
          "type": "singleChoice"
        },
        {
          "id": 6,
          "text": "Как попросить руководителя-администратора? Выберите одно из утверждений",
          "options": [
            "Сформулируйте свое предложение как возможность для развития и спросите совета, мнения руководителя по поводу вашей идеи",
            "Сначала всегда представьте предложение в письменном виде, оформите предложение с четкими инструкциями, графиками, выводами, схемами",
            "Сформулируйте как можно конкретнее, что вы хотите. Объясните смысл (для чего это вам нужно)",
            "Прежде чем представить план на рассмотрение руководителю, заручитесь поддержкой других членов команды, на которых, по его мнению, держится власть"
          ],
          "correctAnswer": 1,
          "type": "singleChoice"
        },
        {
          "id": 7,
          "text": "Как попросить руководителя-предпринимателя? Выберите одно из утверждений",
          "options": [
            "Сформулируйте свое предложение как возможность для развития и спросите совета, мнения руководителя по поводу вашей идеи",
            "Сначала всегда представьте предложение в письменном виде, оформите предложение с четкими инструкциями, графиками, выводами, схемами",
            "Сформулируйте как можно конкретнее, что вы хотите. Объясните смысл (для чего это вам нужно)",
            "Прежде чем представить план на рассмотрение руководителю, заручитесь поддержкой других членов команды, на которых, по его мнению, держится власть"
          ],
          "correctAnswer": 0,
          "type": "singleChoice"
        },
        {
          "id": 8,
          "text": "Как попросить руководителя-интегратора? Выберите одно из утверждений",
          "options": [
            "Сформулируйте свое предложение как возможность для развития и спросите совета, мнения руководителя по поводу вашей идеи",
            "Сначала всегда представьте предложение в письменном виде, оформите предложение с четкими инструкциями, графиками, выводами, схемами",
            "Сформулируйте как можно конкретнее, что вы хотите. Объясните смысл (для чего это вам нужно)",
            "Прежде чем представить план на рассмотрение руководителю, заручитесь поддержкой других членов команды, на которых, по его мнению, держится власть"
          ],
          "correctAnswer": 3,
          "type": "singleChoice"
        },
        {
          "id": 9,
          "text": "Как вести переговоры с клиентом-производителем? Выберите одно из утверждений",
          "options": [
            "Сделайте акцент, как ваше предложение может облегчить работу людей, улучшить условия их труда и отдыха",
            "Сначала обрисуйте общую картину, потом переходите к деталям. Дайте клиенту возможность внести поправки в ваше предложение и обогатить его собственными идеями",
            "Конкретно скажите, какую задачу вы можете решить и какой результат получит клиент, причем быстро"
          ],
          "correctAnswer": 2,
          "type": "singleChoice"
        },
        {
          "id": 10,
          "text": "Как вести переговоры с клиентом-администратором? Выберите одно из утверждений",
          "options": [
            "Сделайте акцент, как ваше предложение может облегчить работу людей, улучшить условия их труда и отдыха",
            "Сначала пришлите свое предложение в письменном виде для предварительного изучения. В предложении вы должны показать, какие проблемы вы сможете решить, какие риски снимете, как поможете сохранить стабильность и безопасность",
            "Сначала обрисуйте общую картину, потом переходите к деталям. Дайте клиенту возможность внести поправки в ваше предложение и обогатить его собственными идеями"
          ],
          "correctAnswer": 1,
          "type": "singleChoice"
        },
        {
          "id": 11,
          "text": "Как вести переговоры с клиентом-предпринимателем? Выберите одно из утверждений",
          "options": [
            "Сделайте акцент, как ваше предложение может облегчить работу людей, улучшить условия их труда и отдыха",
            "Сначала обрисуйте общую картину, потом переходите к деталям. Дайте клиенту возможность внести поправки в ваше предложение и обогатить его собственными идеями",
            "Конкретно скажите, какую задачу вы можете решить и какой результат получит клиент, причем быстро"
          ],
          "correctAnswer": 1,
          "type": "singleChoice"
        },
        {
          "id": 12,
          "text": "Как вести переговоры с клиентом-интегратором? Выберите одно из утверждений",
          "options": [
            "Сделайте акцент, как ваше предложение может облегчить работу людей, улучшить условия их труда и отдыха",
            "Сначала пришлите свое предложение в письменном виде для предварительного изучения. В предложении вы должны показать, какие проблемы вы сможете решить, какие риски снимете, как поможете сохранить стабильность и безопасность",
            "Сначала обрисуйте общую картину, потом переходите к деталям. Дайте клиенту возможность внести поправки в ваше предложение и обогатить его собственными идеями"
          ],
          "correctAnswer": 0,
          "type": "singleChoice"
        }
      ]
    }
  ]
};

export default function TestPage() {
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [userAnswers, setUserAnswers] = useState(INITIAL_ANSWERS);
  const [showResults, setShowResults] = useState(false);
  const [test] = useState(INITIAL_TEST);

  const questions = test.modules[0].questions;
  const currentQuestion = questions[currentQuestionIndex];

  const handleAnswerSelect = (answers) => {
    setUserAnswers((prev) => {
      const newAnswers = [...prev];
      newAnswers[currentQuestionIndex] = answers;
      return newAnswers;
    });
  };

  const handleNext = () => {
    if (currentQuestionIndex < questions.length - 1) {
      setCurrentQuestionIndex((prev) => prev + 1);
    } else {
      setShowResults(true);
    }
  };

  const handlePrevious = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex((prev) => prev - 1);
    }
  };

  const handleRetry = () => {
    setCurrentQuestionIndex(0);
    setUserAnswers(new Array(questions.length).fill([]));
    setShowResults(false);
  };

  if (showResults) {
    return <Results userAnswers={userAnswers} questions={questions} onRetry={handleRetry} />;
  }

  return (
    <div className="min-h-screen bg-gray-50 py-2 sm:py-12">
      <div className="max-w-4xl mx-auto px-2 sm:px-4">
        <div className="bg-white rounded-xl shadow-lg overflow-hidden">
          <div className="p-3 sm:p-6 bg-blue-600">
            <h1 className="text-2xl font-bold text-white">{test.testName}</h1>
            <p className="text-blue-100 mt-2">{test.description}</p>
          </div>

          <div className="p-2 sm:p-4">
            <div className="mb-6">
              <div className="flex justify-between items-center mb-2">
                <span 
                  className="text-sm text-gray-600"
                  role="status"
                  aria-label={`Вопрос ${currentQuestionIndex + 1} из ${questions.length}`}
                >
                  Вопрос {currentQuestionIndex + 1} из {questions.length}
                </span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-2">
                <div
                  className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                  style={{
                    width: `${((currentQuestionIndex + 1) / questions.length) * 100}%`,
                  }}
                  role="progressbar"
                  aria-valuenow={currentQuestionIndex + 1}
                  aria-valuemin={1}
                  aria-valuemax={questions.length}
                />
              </div>
            </div>

            <Question
              question={currentQuestion}
              selectedAnswers={userAnswers[currentQuestionIndex] || []}
              onAnswerSelect={handleAnswerSelect}
            />

            <div className="flex justify-between mt-8">
              <button
                onClick={handlePrevious}
                disabled={currentQuestionIndex === 0}
                className="px-4 sm:px-6 py-2 rounded-lg bg-gray-200 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-300 transition-colors focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 focus:outline-none"
                aria-label="Перейти к предыдущему вопросу"
              >
                Назад
              </button>

              <button
                onClick={handleNext}
                disabled={!userAnswers[currentQuestionIndex]?.length}
                className="px-4 sm:px-6 py-2 rounded-lg bg-blue-600 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 transition-colors focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none"
                aria-label={currentQuestionIndex === questions.length - 1 ? "Завершить тест" : "Перейти к следующему вопросу"}
              >
                {currentQuestionIndex === questions.length - 1 ? "Завершить" : "Далее"}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}